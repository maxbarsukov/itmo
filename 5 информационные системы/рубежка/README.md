# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

## –†—É–±–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1

<img alt="Megumin Explosion" src="https://github.com/maxbarsukov/itmo/blob/master/.docs/megumin-explosion-2.gif" height="300">

> [!TIP]
> –Ø —Ç-—Ç–µ–±—è –≤ –∫—É–± —Å–∫–ª–µ—é. –£ –º–µ–Ω—è –µ—Å—Ç—å –Ω–∞ —Ä–∞–π–æ–Ω–µ –¥-–¥—Ä—É–∑—å—è, –æ–Ω–∏ —Ç–µ–±–µ –∑-–∑–∞ –Ω–µ—á—ë—Ç–∫—É—é –ª–æ–≥–∏–∫—É –ø–æ—è—Å–Ω—è—Ç! \
> ‚Äî chad –ü–æ–ª—è–∫–æ–≤ \
> –ö–æ—Ä–æ—á–µ, ...—ç... –±–∞–∑–∞ –¥–∞–Ω—ã—Ö... –≠... –≠—Ç–æ... –≠... –≠—Ç–æ –∫–∞–∫ –±–∞–∑–∞... —ç... –ù–æ —Ç–æ–ª—å–∫–æ —Å... –≠... –î–∞–Ω–Ω—ã–º–∏. \
> ‚Äî virgin –ù–∏–∫–æ–ª–∞–µ–≤ \
> ¬© –º–µ–º by –î–∞–Ω–∏–∏–ª –ë–∞–±–µ–Ω–∫–æ

---

## –í–∞—Ä–∏–∞–Ω—Ç

[–ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É](https://docs.google.com/spreadsheets/d/1d8I2OBxrKVKroPqx6H4ldubav7IWp8E9UIeCWBMs124/edit?gid=901106186#gid=901106186)

–í –ø–µ—Ä–≤–æ–º –ø–æ—Ç–æ–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –ø–æ –¥–Ω—é —Ä–æ–∂–¥–µ–Ω–∏—è:

- `31.12.5678 -> –í–∞—Ä–∏–∞–Ω—Ç 1`

–í–æ –≤—Ç–æ—Ä–æ–º –ø–æ—Ç–æ–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–∏—Ñ—Ä–µ –ò–°–£:

- `–ò–°–£ 367081 -> –í–∞—Ä–∏–∞–Ω—Ç 1` 

## –ó–∞–¥–∞–Ω–∏–µ

<details> 
  <summary>üì∏ <b>–§–æ—Ç–æ –∑–∞–¥–∞–Ω–∏—è</b></summary>

  <img alt="–†—É–±–µ–∂–∫–∞ 1. –ó–∞–¥–∞–Ω–∏–µ." src="./task.jpg">
</details>

### –ó–∞–¥–∞–Ω–∏–µ 1.

> [!NOTE]
> –ü–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –±—ã–ª–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —É –æ–±–æ–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.

–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–æ–¥—É–º–∞—Ç—å ER-–º–æ–¥–µ–ª—å (**–º–∏–Ω–∏–º—É–º 4** —Å—É—â–Ω–æ—Å—Ç–∏) –¥–ª—è **—Å–∏—Å—Ç–µ–º—ã –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤**. –í –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å **—Å—É—â–Ω–æ—Å—Ç—å ¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å¬ª/¬´–£—á–∞—Å—Ç–Ω–∏–∫¬ª**, —É –Ω–µ–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏. –í ER-–º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤—è–∑—å **–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º**. –£–∫–∞–∑–∞—Ç—å **–Ω–∞–∑–≤–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π** (–∏–∑ ER-–º–æ–¥–µ–ª–∏) –∏ **–º–µ–∂–¥—É –∫–∞–∫–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º**. **–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –¥–ª—è JPA –∫–ª–∞—Å—Å–æ–≤-—Å—É—â–Ω–æ—Å—Ç–µ–π**, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü—ã –ë–î (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ ER-–º–æ–¥–µ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ PostgreSQL).

### –ó–∞–¥–∞–Ω–∏–µ 2.

> [!NOTE]
> –í–æ –≤—Ç–æ—Ä–æ–º –ø–æ—Ç–æ–∫–µ –∑–∞–¥–∞–Ω–∏–µ –±—ã–ª–æ –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–µ –∂–µ, –Ω–æ –Ω—É–∂–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞—Ç—å –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –µ—â—ë –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–∫–∞–∑–µ, –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –∑–∞–¥–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–¥—É–º–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **JPA (–≤–∫–ª—é—á–∞—è —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –∑–∞–¥–∞–Ω–∏—è 1)** –∏ **Spring MVC** (—á—ë—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç) / **Jakarta EE + JSF** (–Ω–µ—á—ë—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç).

–¢—Ä–µ–±—É–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–≤–æ–¥–∞:

```
     +----------------+
–ò–º—è: | –í–≤–µ–¥–∏—Ç–µ –∏–º—è... |
     +----------------+

        +--------+
        | Submit |
        +--------+
```

---

## –†–∞–∑–±–æ—Ä

- –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç—å—é `–ö–∏–Ω–æ–∑–∞–ª`.

### –ó–∞–¥–∞–Ω–∏–µ 1.

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ER-–º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∏–Ω–æ–∑–∞–ª–∞.

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (User)** ‚Äì –∫–ª–∏–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã, –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—â–∏–π –∑–∞–∫–∞–∑—ã.
- **–§–∏–ª—å–º (Movie)** ‚Äì —Ñ–∏–ª—å–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º—ã–π –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ.
- **–°–µ–∞–Ω—Å (Session)** ‚Äì –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–∫–∞–∑ —Ñ–∏–ª—å–º–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
- **–ó–∞–∫–∞–∑ (Order)** ‚Äì –∑–∞–∫–∞–∑, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å–µ–∞–Ω—Å.
- **–ú–µ—Å—Ç–æ (Seat)** ‚Äì –º–µ—Å—Ç–æ –≤ –∑–∞–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—Ä–æ–Ω–∏—Ä—É–µ—Ç.
- **–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä (Cinema)** ‚Äì –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä, –≥–¥–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–µ–∞–Ω—Å—ã.

–°–≤—è–∑–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å **–º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤**, –∏ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω **—Å –æ–¥–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** (*—Å–≤—è–∑—å –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º*).
- **–§–∏–ª—å–º** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ **–º–Ω–æ–≥–∏—Ö —Å–µ–∞–Ω—Å–∞—Ö**, –∏ –∫–∞–∂–¥—ã–π —Å–µ–∞–Ω—Å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è **–∫ –æ–¥–Ω–æ–º—É —Ñ–∏–ª—å–º—É** (*—Å–≤—è–∑—å –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º*).
- **–°–µ–∞–Ω—Å** —Å–≤—è–∑–∞–Ω —Å **–º–Ω–æ–≥–∏–º–∏ –º–µ—Å—Ç–∞–º–∏**, –∏ –∫–∞–∂–¥–æ–µ –º–µ—Å—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ **—Å –º–Ω–æ–≥–∏–º–∏ —Å–µ–∞–Ω—Å–∞–º–∏** (*—Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º*).
- **–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä** —Å–æ–¥–µ—Ä–∂–∏—Ç **–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ–∞–Ω—Å–æ–≤**, –∏ –∫–∞–∂–¥—ã–π —Å–µ–∞–Ω—Å –ø—Ä–∏–≤—è–∑–∞–Ω **–∫ –æ–¥–Ω–æ–º—É –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä—É** (*—Å–≤—è–∑—å –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º*).

–°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º:
- –ú–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ **–°–µ–∞–Ω—Å (Session)** –∏ **–ú–µ—Å—Ç–æ (Seat)**: –æ–¥–Ω–æ –º–µ—Å—Ç–æ –º–æ–∂–µ—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∞–Ω—Å–∞—Ö, –∏ –æ–¥–∏–Ω —Å–µ–∞–Ω—Å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç.

**–ö–æ–¥ –¥–ª—è JPA –∫–ª–∞—Å—Å–æ–≤-—Å—É—â–Ω–æ—Å—Ç–µ–π**

1. –°—É—â–Ω–æ—Å—Ç—å `User`:

```java
import jakarta.persistence.*;
import java.util.List;

@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;

    @Column(nullable = false, unique = true)
    private String email;

    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
    private List<Order> orders;

    // Getters and Setters
}
```

2. –°—É—â–Ω–æ—Å—Ç—å `Movie`:

```java
import jakarta.persistence.*;
import java.util.List;

@Entity
@Table(name = "movies")
public class Movie {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String title;

    @Column(nullable = false)
    private String genre;

    @OneToMany(mappedBy = "movie", cascade = CascadeType.ALL)
    private List<Session> sessions;

    // Getters and Setters
}
```

3. –°—É—â–Ω–æ—Å—Ç—å `Cinema`:

```java
import jakarta.persistence.*;
import java.util.List;

@Entity
@Table(name = "cinemas")
public class Cinema {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;

    @OneToMany(mappedBy = "cinema", cascade = CascadeType.ALL)
    private List<Session> sessions;

    // Getters and Setters
}
```

4. –°—É—â–Ω–æ—Å—Ç—å `Session`:

```java
import jakarta.persistence.*;
import java.util.List;

@Entity
@Table(name = "sessions")
public class Session {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "movie_id", nullable = false)
    private Movie movie;

    @ManyToOne
    @JoinColumn(name = "cinema_id", nullable = false)
    private Cinema cinema;

    @ManyToMany
    @JoinTable(
        name = "session_seats",
        joinColumns = @JoinColumn(name = "session_id"),
        inverseJoinColumns = @JoinColumn(name = "seat_id")
    )
    private List<Seat> seats;

    @OneToMany(mappedBy = "session", cascade = CascadeType.ALL)
    private List<Order> orders;

    // Getters and Setters
}
```

5. –°—É—â–Ω–æ—Å—Ç—å `Seat`:

```java
import jakarta.persistence.*;
import java.util.List;

@Entity
@Table(name = "seats")
public class Seat {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String seatNumber;

    @ManyToMany(mappedBy = "seats")
    private List<Session> sessions;

    // Getters and Setters
}
```

6. –°—É—â–Ω–æ—Å—Ç—å `Order`:

```java
import jakarta.persistence.*;

@Entity
@Table(name = "orders")
public class Order {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @ManyToOne
    @JoinColumn(name = "session_id", nullable = false)
    private Session session;

    @Column(nullable = false)
    private String seatNumber;

    // Getters and Setters
}
```

### –ó–∞–¥–∞–Ω–∏–µ 2.

#### Spring MVC

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

```
+--------------------------+
|        –í–µ–±-–±—Ä–∞—É–∑–µ—Ä       |
|    (HTML-—Ñ–æ—Ä–º–∞: –ò–º—è)     |
+------------+-------------+
             |
             v
+--------------------------+
|   Spring MVC Controller  |
|     (OrderController)    |
+------------+-------------+
             |
             v
+--------------------------+
|      Service Layer       |
|      (OrderService)      |
+------------+-------------+
             |
             v
+--------------------------+
|      Repository Layer    |
|     (OrderRepository)    |
|    (EntityManager API)   |
+------------+-------------+
             |
             v
+--------------------------+
|        PostgreSQL        |
|        (Database)        |
+--------------------------+
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

1. HTML-–§–æ—Ä–º–∞

–§–æ—Ä–º–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.

`index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Last Order</title>
</head>
<body>
    <form action="/orders/last" method="get">
        <label for="name">–ò–º—è:</label>
        <input type="text" id="name" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." required />
        <button type="submit">Submit</button>
    </form>
</body>
</html>
```

2. Spring MVC Controller

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.

`OrderController.java`

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class OrderController {

    private final OrderService orderService;

    @Autowired
    public OrderController(OrderService orderService) {
        this.orderService = orderService;
    }

    @GetMapping("/orders/last")
    public String getLastOrder(@RequestParam("name") String userName, Model model) {
        Order lastOrder = orderService.findLastOrderForUser(userName);
        model.addAttribute("order", lastOrder);
        return "last-order"; // HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    }
}
```

3. Service Layer

–°–µ—Ä–≤–∏—Å –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

`OrderService.java`

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class OrderService {

    private final OrderRepository orderRepository;

    @Autowired
    public OrderService(OrderRepository orderRepository) {
        this.orderRepository = orderRepository;
    }

    public Order findLastOrderForUser(String userName) {
        return orderRepository.findLastOrderByUserName(userName);
    }
}
```

4. Repository Layer (–±–µ–∑ Spring Data JPA)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º EntityManager.

`OrderRepository.java`

```java
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import jakarta.persistence.TypedQuery;
import org.springframework.stereotype.Repository;

@Repository
public class OrderRepository {

    @PersistenceContext
    private EntityManager entityManager;

    public Order findLastOrderByUserName(String userName) {
        String query = "SELECT o FROM Order o JOIN o.user u WHERE u.name = :name ORDER BY o.id DESC";
        TypedQuery<Order> typedQuery = entityManager.createQuery(query, Order.class);
        typedQuery.setParameter("name", userName);
        typedQuery.setMaxResults(1); // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑
        return typedQuery.getSingleResult();
    }
}
```

5. Thymeleaf-—à–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–®–∞–±–ª–æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–∫–∞–∑–µ.

`last-order.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Last Order</title>
</head>
<body>
    <h1>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</h1>
    <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span th:text="${order.user.name}"></span></p>
    <p><strong>–°–µ–∞–Ω—Å:</strong> <span th:text="${order.session.movie.title}"></span></p>
    <p><strong>–ú–µ—Å—Ç–æ:</strong> <span th:text="${order.seatNumber}"></span></p>
</body>
</html>
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å–≤–æ–µ –∏–º—è –≤ **HTML-—Ñ–æ—Ä–º—É** –∏ –Ω–∞–∂–∏–º–∞–µ—Ç `Submit`.
2. –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ `/orders/last`, –≥–¥–µ –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `OrderController`.
3. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** –≤—ã–∑—ã–≤–∞–µ—Ç `OrderService` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.
4. **–°–µ—Ä–≤–∏—Å** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `OrderRepository` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ `EntityManager`.
5. –†–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É**.
6. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** –ø–µ—Ä–µ–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ **—à–∞–±–ª–æ–Ω** `last-order.html`, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

#### Jakarta EE + JSF

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

```
+---------------------------+
|        –í–µ–±-–±—Ä–∞—É–∑–µ—Ä        |
|     (JSF-—Ñ–æ—Ä–º–∞: –ò–º—è)      |
+------------+--------------+
             |
             v
+---------------------------+
|     JSF Managed Bean      |
|    (OrderManagedBean)     |
+------------+--------------+
             |
             v
+---------------------------+
|       Service Layer       |
|      (OrderService)       |
+------------+--------------+
             |
             v
+---------------------------+
|     Repository Layer      |
|     (OrderRepository)     |
|    (EntityManager API)    |
+------------+--------------+
             |
             v
+---------------------------+
|         PostgreSQL        |
|         (Database)        |
+---------------------------+
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

1. JSF-—Ñ–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ JSF –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.

`order.xhtml`

```html
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html">
<head>
    <title>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</title>
</head>
<body>
    <h1>–ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
    <h:form>
        <h:outputLabel for="name" value="–ò–º—è:" />
        <h:inputText id="name" value="#{orderBean.userName}" required="true" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." />
        <h:commandButton value="Submit" action="#{orderBean.findLastOrder}" />
    </h:form>

    <h:panelGroup rendered="#{not empty orderBean.lastOrder}">
        <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</h2>
        <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> #{orderBean.lastOrder.user.name}</p>
        <p><strong>–°–µ–∞–Ω—Å:</strong> #{orderBean.lastOrder.session.movie.title}</p>
        <p><strong>–ú–µ—Å—Ç–æ:</strong> #{orderBean.lastOrder.seatNumber}</p>
    </h:panelGroup>
</body>
</html>
```

2. JSF Managed Bean

`OrderManagedBean.java`

```java
import jakarta.enterprise.context.RequestScoped;
import jakarta.inject.Inject;
import jakarta.inject.Named;

@Named("orderBean")
@RequestScoped
public class OrderManagedBean {

    @Inject
    private OrderService orderService;

    private String userName;
    private Order lastOrder;

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public Order getLastOrder() {
        return lastOrder;
    }

    public void setLastOrder(Order lastOrder) {
        this.lastOrder = lastOrder;
    }

    public String findLastOrder() {
        this.lastOrder = orderService.findLastOrderForUser(userName);
        return null; // –û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    }
}
```

3. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π

`OrderService.java`

```java
import jakarta.ejb.Stateless;
import jakarta.inject.Inject;

@Stateless
public class OrderService {

    @Inject
    private OrderRepository orderRepository;

    public Order findLastOrderForUser(String userName) {
        return orderRepository.findLastOrderByUserName(userName);
    }
}
```

4. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º EntityManager)

`OrderRepository.java`

```java
java
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import jakarta.persistence.TypedQuery;
import jakarta.ejb.Stateless;

@Stateless
public class OrderRepository {

    @PersistenceContext
    private EntityManager entityManager;

    public Order findLastOrderByUserName(String userName) {
        String query = "SELECT o FROM Order o JOIN o.user u WHERE u.name = :name ORDER BY o.id DESC";
        TypedQuery<Order> typedQuery = entityManager.createQuery(query, Order.class);
        typedQuery.setParameter("name", userName);
        typedQuery.setMaxResults(1);
        return typedQuery.getSingleResult();
    }
}
```

5. JPA-–∫–ª–∞—Å—Å—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ –ó–∞–¥–∞–Ω–∏—è 1)

–ú—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã-—Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –ó–∞–¥–∞–Ω–∏—è 1, —Ç–∞–∫–∏–µ –∫–∞–∫ Order, User, Session, –∏ –¥—Ä—É–≥–∏–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ persistence —É–∫–∞–∑–∞–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL.

6. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

`persistence.xml`

```xml
xml
<persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
             version="2.1">
    <persistence-unit name="cinemaPU">
        <class>com.example.entities.User</class>
        <class>com.example.entities.Order</class>
        <class>com.example.entities.Session</class>
        <class>com.example.entities.Movie</class>
        <class>com.example.entities.Seat</class>
        <properties>
            <property name="jakarta.persistence.jdbc.driver" value="org.postgresql.Driver" />
            <property name="jakarta.persistence.jdbc.url" value="jdbc:postgresql://localhost:5432/cinema_db" />
            <property name="jakarta.persistence.jdbc.user" value="postgres" />
            <property name="jakarta.persistence.jdbc.password" value="password" />
            <property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQLDialect" />
            <property name="hibernate.hbm2ddl.auto" value="update" />
        </properties>
    </persistence-unit>
</persistence>
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:**

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤–≤–æ–¥–∏—Ç –∏–º—è –≤ —Ñ–æ—Ä–º—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/order.xhtml`.
2. –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ `Submit` –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `OrderManagedBean`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `OrderService` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞.
3. **–°–µ—Ä–≤–∏—Å** –≤—ã–∑—ã–≤–∞–µ—Ç `OrderRepository`, –∫–æ—Ç–æ—Ä—ã–π —Å –ø–æ–º–æ—â—å—é `EntityManager` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ **–±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**.
4. –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `OrderManagedBean`, –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `lastOrder`.
5. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ **–ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–∫–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**.
6. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jakarta EE —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ JSF –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, CDI –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∏ JPA –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

| –°—Å—ã–ª–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| [practicum.yandex.ru/blog/chto-takoe-er-diagramma/](https://practicum.yandex.ru/blog/chto-takoe-er-diagramma/) | –°—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏: —á—Ç–æ —Ç–∞–∫–æ–µ ER‚Äë–¥–∏–∞–≥—Ä–∞–º–º–∞? |
| [java-online.ru/jsf-components.xhtml](https://java-online.ru/jsf-components.xhtml) | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ JSF components |

## –õ–∏—Ü–µ–Ω–∑–∏—è <a name="license"></a>

–ü—Ä–æ–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö [–õ–∏—Ü–µ–Ω–∑–∏–∏ GNU GPL 3](https://opensource.org/license/gpl-3-0/). \
*–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ 2024 Max Barsukov*

**–ü–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É :star:, –µ—Å–ª–∏ –≤—ã –Ω–∞—à–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–µ–∑–Ω—ã–º.**
