@startuml Альтернативный поток: Оформление подписки YouTube Premium

actor Пользователь

box "Клиентская система" #White
    participant "Браузер"
    participant "Клиентское приложение"
end box

box "Серверная система" #White
    participant "Сервер"
    database "База данных"
    queue "Очередь сообщений" as Queue
    participant "Сторонний сервис Google (Авторизация)" as GoogleAuth
    participant "Сторонний сервис Google (Платежи)" as GooglePayments
end box

participant "Платежная система"
participant "Банк"
participant "Система уведомлений"
participant "Служба аналитики"

' Альтернативный поток: Сбой на стороне платежной системы
alt Сбой платежа
    "Платежная система" --> GooglePayments: Ошибка обработки платежа
    GooglePayments --> "Клиентское приложение": Платеж отклонен
    "Клиентское приложение" --> "Браузер": Сообщение о сбое
    "Браузер" -> Пользователь: Сообщение о необходимости повторить позже
end

' Альтернативный поток: Региональные ограничения
alt Ограничения тарифа
    "Сервер" -> "Клиентское приложение": Тариф недоступен
    "Клиентское приложение" --> "Браузер": Сообщение об ограничении
    "Браузер" -> Пользователь: Предложение альтернативных тарифов
end

' Альтернативный поток: Отмена платежа
alt Отмена пользователем
    Пользователь -> "Браузер": Отмена процесса на этапе ввода данных
    "Браузер" -> "Клиентское приложение": Сообщение об отмене
    "Клиентское приложение" -> "Сервер": Логирование отмены
    "Сервер" -> "Служба аналитики": Логирование отмены процесса
end

' Альтернативный поток: Ошибка базы данных
alt Ошибка базы данных
    "Сервер" -> "База данных": Запрос на сохранение данных подписки
    "База данных" --> "Сервер": Ошибка сохранения данных
    "Сервер" --> "Клиентское приложение": Сообщение о временной недоступности сервиса
    "Клиентское приложение" --> "Браузер": Уведомление пользователя
    "Браузер" -> Пользователь: Просьба повторить попытку позже
end

' Альтернативный поток: Ошибка авторизации
alt Ошибка авторизации
    "Клиентское приложение" -> GoogleAuth: Запрос авторизации
    GoogleAuth --> "Клиентское приложение": Ошибка авторизации
    "Клиентское приложение" --> "Браузер": Сообщение о невозможности продолжить
    "Браузер" -> Пользователь: Просьба войти в аккаунт повторно
end

' Альтернативный поток: Истечение времени ожидания
alt Истечение времени ожидания
    Пользователь -> "Браузер": Медленная реакция на запросы
    "Браузер" -> "Клиентское приложение": Истечение времени ожидания
    "Клиентское приложение" --> "Браузер": Сообщение о тайм-ауте
    "Браузер" -> Пользователь: Уведомление о необходимости обновить страницу
end

' Альтернативный поток: Недостаточно средств на карте
alt Недостаточно средств
    "Платежная система" --> GooglePayments: Ошибка из-за недостатка средств
    GooglePayments --> "Клиентское приложение": Транзакция отклонена
    "Клиентское приложение" --> "Браузер": Сообщение о проблеме
    "Браузер" -> Пользователь: Просьба проверить баланс и повторить попытку
end

' Альтернативный поток: Технические работы сервиса уведомлений
alt Сбой сервиса уведомлений
    "Сервер" -> "Система уведомлений": Отправка уведомления
    "Система уведомлений" --> "Сервер": Сбой в отправке
    "Сервер" --> Queue: Постановка уведомления в очередь повторной отправки
    Queue --> "Сервер": Уведомление будет отправлено позже
    "Сервер" --> "Клиентское приложение": Уведомление о задержке
    "Клиентское приложение" --> "Браузер": Информация для пользователя
end

@enduml
